self.onmessage=async l=>{const{file:p,bookId:d}=l.data;try{const r=await p.arrayBuffer(),{default:i}=await import("./index-C6jzhtju.js"),s=i(r);await s.opened;const a=[];let f=0,t=0;const c=s.spine.items,g=c.length;for(const n of c){t++;try{await n.load(s.load.bind(s));const e=n.document;if(!e||!e.body)continue;(e.body.textContent||e.body.innerText||"").split(/\s+/).map(o=>o.trim()).filter(o=>o.length>0).forEach(o=>{a.push({bookId:d,tokenIdx:f++,word:o,page:t,bbox:null})}),n.unload()}catch(e){console.error(`Error parsing chapter ${t}:`,e)}self.postMessage({type:"progress",page:t,total:g})}self.postMessage({type:"complete",tokens:a,numPages:t,totalWords:a.length})}catch(r){console.error("EPUB parse error:",r),self.postMessage({type:"error",error:r.message||"Failed to parse EPUB"})}};
//# sourceMappingURL=epub-parser.worker-BFsmoAS_.js.map
